<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Meu Controle de Despesas</title>

  <meta name="theme-color" content="#4CAF50" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Despesas" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <link rel="icon" type="image/svg+xml"
    href="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20100%20100'%3E%3Crect%20width='100'%20height='100'%20rx='20'%20fill='%234CAF50'/%3E%3Ctext%20x='50'%20y='67'%20font-size='58'%20text-anchor='middle'%20fill='white'%3E%F0%9F%92%B0%3C/text%3E%3C/svg%3E" />
  <link rel="apple-touch-icon"
    href="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20100%20100'%3E%3Crect%20width='100'%20height='100'%20rx='20'%20fill='%234CAF50'/%3E%3Ctext%20x='50'%20y='67'%20font-size='58'%20text-anchor='middle'%20fill='white'%3E%F0%9F%92%B0%3C/text%3E%3C/svg%3E" />

  <style>
    :root{
      --primary:#4CAF50; --dark:#2E7D32; --light:#E8F5E9;
      --card:#FFFFFF; --text:#222; --muted:#666; --border:#d9d9d9;
      --shadow: 0 1px 3px rgba(0,0,0,0.10);
      --danger:#d32f2f; --info:#2196F3; --bg: var(--light);
    }
    body.dark{
      --bg:#0f1411; --card:#151b17; --text:#f1f1f1; --muted:#b9b9b9;
      --border:#2a332d; --shadow: 0 1px 3px rgba(0,0,0,0.45);
    }
    *{ box-sizing:border-box; margin:0; padding:0; font-family: system-ui, -apple-system, sans-serif;}
    body{ background: var(--bg); color: var(--text); padding: 16px; max-width: 760px; margin: 0 auto; font-size: 18px; line-height: 1.35; }
    header{
      background: var(--primary); color:#fff; border-radius: 14px; padding: 14px; box-shadow: var(--shadow);
      display:flex; align-items:center; justify-content: space-between; gap: 12px;
    }
    header h1{ font-size: 1.25rem; }
    .top-actions{ display:flex; gap: 10px; align-items:center; }
    .chip{
      background: rgba(255,255,255,0.18); border: 1px solid rgba(255,255,255,0.25); color:#fff;
      padding: 8px 10px; border-radius: 999px; font-size: 0.95rem; cursor:pointer; user-select:none; white-space: nowrap;
    }
    .card{ background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 14px; margin-top: 14px; box-shadow: var(--shadow); }
    .row{ display:flex; gap: 12px; flex-wrap: wrap; }
    .col{ flex:1; min-width: 220px; }
    label{ display:block; font-weight: 800; margin-bottom: 6px; }
    input, select{
      width:100%; padding: 12px; border: 1px solid var(--border); background: transparent; color: var(--text);
      border-radius: 12px; font-size: 1rem; outline: none;
    }
    button{
      width: 100%; padding: 12px; border-radius: 12px; border: none; font-size: 1.05rem; cursor:pointer;
      background: var(--primary); color:#fff; font-weight: 900;
    }
    .btn-ghost{ background: transparent; border: 1px solid var(--border); color: var(--text); font-weight: 900; }
    .btn-danger{ background: var(--danger); }
    .small{ color: var(--muted); font-size: 0.95rem; }
    .balance{ text-align:center; font-weight: 900; color: var(--dark); font-size: 1.12rem; }
    body.dark .balance{ color: #a7ffb0; }

    .calendar{ display:grid; grid-template-columns: repeat(7, 1fr); gap: 6px; margin-top: 10px; }
    .cal-day{
      text-align:center; padding: 10px 6px; background: rgba(0,0,0,0.06); border-radius: 10px;
      font-size: 0.95rem; border: 1px solid transparent; cursor: pointer; user-select:none;
    }
    body.dark .cal-day{ background: rgba(255,255,255,0.08); }
    .cal-day.head{ background: transparent; border:none; cursor: default; font-weight:900; color: var(--muted); }
    .cal-day.has-data{ background: var(--primary); color:#fff; }
    .cal-day.today{ border-color: var(--dark); }
    body.dark .cal-day.today{ border-color: #a7ffb0; }
    .cal-day.selected{ outline: 3px solid rgba(33,150,243,0.45); }

    .detail-item{
      display:flex; gap: 10px; align-items:flex-start; justify-content: space-between;
      padding: 10px 0; border-bottom: 1px solid var(--border);
    }
    .detail-item:last-child{ border-bottom:none; }
    .detail-main{ font-weight: 900; margin-bottom: 2px; }
    .detail-note{ color: var(--muted); font-size: 0.95rem; word-break: break-word; }
    .detail-actions{ display:flex; gap: 8px; flex-shrink: 0; }
    .mini-btn{ width: auto; padding: 10px 10px; border-radius: 10px; font-size: 0.95rem; font-weight: 900; }

    .modal-backdrop{
      position: fixed; inset: 0; background: rgba(0,0,0,0.55);
      display:none; align-items:center; justify-content:center; padding: 16px; z-index: 999;
    }
    .modal{
      width: 100%; max-width: 520px; background: var(--card); color: var(--text);
      border: 1px solid var(--border); border-radius: 16px; padding: 14px; box-shadow: var(--shadow);
    }
    .modal h3{ margin-bottom: 10px; }
    .modal .row{ margin-top: 10px; }
    .modal .modal-actions{ display:flex; gap: 10px; margin-top: 12px; }
    .modal .modal-actions button{ flex:1; }

    .pill{
      display:inline-block; padding: 6px 10px; border-radius: 999px;
      border: 1px solid var(--border); font-weight: 900; font-size: 0.92rem;
      background: rgba(0,0,0,0.03);
    }
    body.dark .pill{ background: rgba(255,255,255,0.06); }
    footer{ margin-top: 18px; text-align:center; color: var(--muted); font-size: 0.9rem; padding-bottom: 10px; }
  </style>
</head>

<body>
  <header>
    <h1>üí∞ Controle de Despesas</h1>
    <div class="top-actions">
      <div class="chip" id="darkToggle">üåô Modo</div>
      <div class="chip" id="helpBtn">‚ùî Ajuda</div>
    </div>
  </header>

  <div class="card balance" id="balance">Balan√ßo de hoje: R$ 0,00</div>

  <div class="card">
    <div class="row" style="align-items:center; justify-content: space-between;">
      <div class="pill" id="statusPill">Carregando...</div>
      <div class="small" id="originHint"></div>
    </div>

    <div class="row" style="margin-top:12px;">
      <div class="col">
        <label for="date">Data</label>
        <input type="date" id="date">
        <div class="small" id="dateBR" style="margin-top:6px;"></div>
      </div>

      <div class="col">
        <label for="amount">Valor</label>
        <input type="text" id="amount" inputmode="numeric" autocomplete="off" placeholder="R$ 0,00">
        <div class="small" style="margin-top:6px;">Digite ‚Äú1250‚Äù ‚Üí R$ 12,50</div>
      </div>
    </div>

    <div class="row" style="margin-top:12px;">
      <div class="col">
        <label for="category">Categoria</label>
        <select id="category"></select>
      </div>
      <div class="col">
        <label for="note">Observa√ß√£o (opcional)</label>
        <input type="text" id="note" placeholder="Ex: almo√ßo, farm√°cia...">
      </div>
    </div>

    <div class="row" style="margin-top:12px;">
      <button class="btn-ghost" type="button" onclick="setToday()">üìå Hoje</button>
    </div>

    <button style="margin-top:10px;" onclick="addExpense()">üíæ Gravar despesa</button>
    <div class="small" id="saveStatus" style="margin-top:10px;"></div>
  </div>

  <div class="card">
    <div style="font-weight:900;">üìÖ Calend√°rio</div>
    <div class="small">Clique em um dia para ver, editar ou excluir.</div>
    <div class="calendar" id="calendar"></div>
  </div>

  <div class="card">
    <div style="font-weight:900;" id="selectedDayTitle">üßæ Detalhe do dia</div>
    <div class="small" id="selectedDaySubtitle">Selecione um dia no calend√°rio.</div>
    <div id="dayDetailList" style="margin-top:10px;"></div>
  </div>

  <footer>¬© 2026 Ricardo de Faria Barros</footer>

  <!-- Modal Editar -->
  <div class="modal-backdrop" id="editBackdrop" role="dialog" aria-modal="true">
    <div class="modal">
      <h3>‚úèÔ∏è Editar despesa</h3>
      <div class="small" id="editInfo"></div>

      <div class="row">
        <div class="col">
          <label for="editAmount">Valor (R$)</label>
          <input type="number" id="editAmount" step="0.01" min="0">
        </div>
        <div class="col">
          <label for="editCategory">Categoria</label>
          <select id="editCategory"></select>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label for="editNote">Observa√ß√£o</label>
          <input type="text" id="editNote" placeholder="Opcional">
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn-ghost" onclick="closeEdit()">Cancelar</button>
        <button onclick="saveEdit()">Salvar</button>
      </div>
    </div>
  </div>

  <!-- Modal Ajuda -->
  <div class="modal-backdrop" id="helpBackdrop" role="dialog" aria-modal="true">
    <div class="modal">
      <h3>‚ùî Ajuda r√°pida</h3>
      <div class="small">
        ‚Ä¢ Este app salva LOCALMENTE no seu navegador (no mesmo celular e mesma URL).<br>
        ‚Ä¢ N√£o use modo an√¥nimo.<br>
        ‚Ä¢ Evite abrir dentro do Instagram/Facebook: abra no Chrome/Safari.<br>
        ‚Ä¢ iPhone: Safari ‚Üí Compartilhar ‚Üí ‚ÄúAdicionar √† Tela de In√≠cio‚Äù.
      </div>
      <div class="modal-actions" style="margin-top:12px;">
        <button onclick="closeHelp()">Fechar</button>
      </div>
    </div>
  </div>

<script>
/* =========================
   IndexedDB (local, robusto)
   ========================= */
const DB_NAME = "despesas_local_db_v1";
const DB_VER  = 1;
const STORE   = "kv";

function openDB(){
  return new Promise((resolve, reject) => {
    const req = indexedDB.open(DB_NAME, DB_VER);
    req.onupgradeneeded = () => {
      const db = req.result;
      if (!db.objectStoreNames.contains(STORE)) db.createObjectStore(STORE);
    };
    req.onsuccess = () => resolve(req.result);
    req.onerror = () => reject(req.error);
  });
}
async function idbGet(key){
  const db = await openDB();
  return new Promise((resolve, reject) => {
    const tx = db.transaction(STORE, "readonly");
    const st = tx.objectStore(STORE);
    const r = st.get(key);
    r.onsuccess = () => resolve(r.result);
    r.onerror = () => reject(r.error);
  });
}
async function idbSet(key, val){
  const db = await openDB();
  return new Promise((resolve, reject) => {
    const tx = db.transaction(STORE, "readwrite");
    const st = tx.objectStore(STORE);
    const r = st.put(val, key);
    r.onsuccess = () => resolve(true);
    r.onerror = () => reject(r.error);
  });
}

/* =========================
   Dados + UI
   ========================= */
const CATEGORIES = [
  { id:"alimentacao", label:"üõí Alimenta√ß√£o" },
  { id:"feira", label:"üß∫ Feira" },
  { id:"padaria", label:"ü•ê Padaria" },
  { id:"bares", label:"üç∑ Bares/Restaurantes" },
  { id:"farmacia", label:"üíä Farm√°cia" },
  { id:"gasolina", label:"‚õΩ Gasolina" },
  { id:"uber", label:"üöï Uber/Transporte" },
  { id:"agua", label:"üíß √Ågua" },
  { id:"energia", label:"‚ö° Energia" },
  { id:"telefone", label:"üì± Telefone/Internet" },
  { id:"condominio", label:"üè¢ Condom√≠nio" },
  { id:"diarista", label:"üßπ Diarista" },
  { id:"impostos", label:"üèõÔ∏è Impostos" },
  { id:"manutencao", label:"üîß Manuten√ß√£o" },
  { id:"lazer", label:"üé≠ Lazer" },
  { id:"contas", label:"üìÑ Contas Fixas" },
  { id:"cartao", label:"üí≥ Fatura Cart√£o" },
  { id:"dizimo", label:"‚ù§Ô∏è D√≠zimo/Doa√ß√£o" },
  { id:"online", label:"üì¶ Compras Online" },
  { id:"diversos", label:"‚ú® Diversos" }
];

function fillCategorySelect(el){
  el.innerHTML = "";
  for (const c of CATEGORIES){
    const o = document.createElement("option");
    o.value = c.id;
    o.textContent = c.label;
    el.appendChild(o);
  }
}
fillCategorySelect(document.getElementById("category"));
fillCategorySelect(document.getElementById("editCategory"));

function formatDateISO(date = new Date()) { return date.toISOString().split("T")[0]; }
function formatBR(dateStr) { const [y,m,d] = dateStr.split("-"); return `${d}/${m}/${y}`; }
function parseISO(dateStr){ const [y,m,d] = dateStr.split("-").map(n=>parseInt(n,10)); return new Date(y, m-1, d); }
function formatCurrency(v){ return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(v); }
function safeNumber(n){ return (typeof n === "number" && isFinite(n)) ? n : 0; }

function brlFromDigits(digits){
  const clean = (digits || "").replace(/\D/g, "");
  const cents = clean === "" ? 0 : parseInt(clean, 10);
  const value = cents / 100;
  return new Intl.NumberFormat("pt-BR", { style: "currency", currency: "BRL" }).format(value);
}
function parseBRL(masked){
  const clean = String(masked || "").replace(/\D/g, "");
  if (!clean) return 0;
  const cents = parseInt(clean, 10);
  return cents / 100;
}
function applyMoneyMask(el){
  const digits = el.value.replace(/\D/g, "");
  el.value = brlFromDigits(digits);
  try { el.setSelectionRange(el.value.length, el.value.length); } catch {}
}

function uuid(){ return Math.random().toString(16).slice(2) + "-" + Date.now().toString(16); }
function escapeHTML(str){
  return String(str)
    .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
    .replaceAll('"',"&quot;").replaceAll("'","&#039;");
}

/* =========================
   Estado (local)
   ========================= */
let expenses = {};
let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();
const todayISO = formatDateISO(new Date());
let selectedDay = todayISO;

const statusPill = document.getElementById("statusPill");
const originHint = document.getElementById("originHint");
originHint.textContent = `Origem: ${location.origin}`;

/* =========================
   Prefer√™ncias
   ========================= */
const darkStored = localStorage.getItem("pref_dark");
const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
const darkOn = (darkStored === null) ? prefersDark : (darkStored === "1");
if (darkOn) document.body.classList.add("dark");
document.getElementById("darkToggle").addEventListener("click", () => {
  document.body.classList.toggle("dark");
  localStorage.setItem("pref_dark", document.body.classList.contains("dark") ? "1" : "0");
});

/* =========================
   Ajuda
   ========================= */
const helpBackdrop = document.getElementById("helpBackdrop");
document.getElementById("helpBtn").addEventListener("click", () => helpBackdrop.style.display = "flex");
function closeHelp(){ helpBackdrop.style.display = "none"; }
window.closeHelp = closeHelp;
helpBackdrop.addEventListener("click", (e) => { if (e.target === helpBackdrop) closeHelp(); });

/* =========================
   Inputs
   ========================= */
const dateInput = document.getElementById("date");
const amountInput = document.getElementById("amount");
const categoryInput = document.getElementById("category");
const noteInput = document.getElementById("note");
const saveStatus = document.getElementById("saveStatus");

dateInput.value = todayISO;
setDateBRHint(todayISO);
function setDateBRHint(iso){ document.getElementById("dateBR").textContent = iso ? `Formato: ${formatBR(iso)}` : ""; }
dateInput.addEventListener("change", () => setDateBRHint(dateInput.value));

amountInput.value = "R$ 0,00";
amountInput.addEventListener("input", () => applyMoneyMask(amountInput));
amountInput.addEventListener("focus", () => {
  if (!amountInput.value.trim()) amountInput.value = "R$ 0,00";
  try { amountInput.setSelectionRange(amountInput.value.length, amountInput.value.length); } catch {}
});

amountInput.addEventListener("keydown", (e) => { if (e.key === "Enter"){ e.preventDefault(); categoryInput.focus(); }});
categoryInput.addEventListener("keydown", (e) => { if (e.key === "Enter"){ e.preventDefault(); noteInput.focus(); }});
noteInput.addEventListener("keydown", (e) => { if (e.key === "Enter"){ e.preventDefault(); addExpense(); }});

function setToday(){
  const today = formatDateISO(new Date());
  dateInput.value = today;
  setDateBRHint(today);
  selectedDay = today;
  currentYear = new Date().getFullYear();
  currentMonth = new Date().getMonth();
  renderAll();
  amountInput.focus();
}
window.setToday = setToday;

/* =========================
   Persist√™ncia (IndexedDB)
   ========================= */
async function loadAll(){
  try{
    const data = await idbGet("expenses");
    expenses = data && typeof data === "object" ? data : {};
    statusPill.textContent = "‚úÖ Salvamento local ativo";
    saveStatus.textContent = "Hist√≥rico carregado do armazenamento local deste aparelho.";
  }catch(e){
    statusPill.textContent = "‚ö†Ô∏è Falha no salvamento local";
    saveStatus.textContent = "Seu navegador bloqueou o armazenamento local. Abra no Chrome/Safari normal (n√£o an√¥nimo).";
    expenses = {};
  }
}
async function saveAll(){
  try{
    await idbSet("expenses", expenses);
    statusPill.textContent = "‚úÖ Salvou localmente";
    return true;
  }catch(e){
    statusPill.textContent = "‚ö†Ô∏è N√£o conseguiu salvar";
    return false;
  }
}

/* =========================
   CRUD
   ========================= */
function dayTotal(iso){
  const list = expenses[iso] || [];
  return list.reduce((s,e) => s + safeNumber(e.amount), 0);
}

async function addExpense(){
  const iso = dateInput.value;
  const amount = parseBRL(amountInput.value);
  const category = categoryInput.value;
  const note = (noteInput.value || "").trim();

  if (!iso) { alert("Selecione uma data."); return; }
  if (!amount || amount <= 0) { alert("Digite um valor v√°lido."); amountInput.focus(); return; }

  if (!expenses[iso]) expenses[iso] = [];
  expenses[iso].push({ id: uuid(), amount, category, note });

  const ok = await saveAll();
  if (!ok){
    alert("N√£o consegui salvar localmente. Abra no Chrome/Safari normal (n√£o an√¥nimo) e tente novamente.");
    return;
  }

  amountInput.value = "R$ 0,00";
  noteInput.value = "";

  selectedDay = iso;
  const d = parseISO(iso);
  currentYear = d.getFullYear();
  currentMonth = d.getMonth();

  saveStatus.textContent = `‚úÖ Despesa gravada em ${formatBR(iso)}.`;
  renderAll();
  amountInput.focus();
}
window.addExpense = addExpense;

async function deleteExpense(dayISO, itemId){
  const list = expenses[dayISO] || [];
  const idx = list.findIndex(x => x.id === itemId);
  if (idx < 0) return;
  if (!confirm("Excluir esta despesa?")) return;
  list.splice(idx,1);
  if (list.length === 0) delete expenses[dayISO];

  const ok = await saveAll();
  if (!ok) return;

  renderAll();
}
window.deleteExpense = deleteExpense;

/* =========================
   Editar
   ========================= */
const editBackdrop = document.getElementById("editBackdrop");
const editInfo = document.getElementById("editInfo");
const editAmount = document.getElementById("editAmount");
const editCategory = document.getElementById("editCategory");
const editNote = document.getElementById("editNote");
let editing = { dayISO:null, id:null };

function openEdit(dayISO, itemId){
  const item = (expenses[dayISO] || []).find(x => x.id === itemId);
  if (!item) return;
  editing = { dayISO, id: itemId };
  editInfo.textContent = `Data: ${formatBR(dayISO)}`;
  editAmount.value = String(item.amount ?? "");
  editCategory.value = item.category ?? "diversos";
  editNote.value = item.note ?? "";
  editBackdrop.style.display = "flex";
}
window.openEdit = openEdit;

function closeEdit(){ editBackdrop.style.display = "none"; editing = { dayISO:null, id:null }; }
window.closeEdit = closeEdit;

async function saveEdit(){
  const { dayISO, id } = editing;
  if (!dayISO || !id) return;

  const item = (expenses[dayISO] || []).find(x => x.id === id);
  if (!item) return;

  const amount = parseFloat(editAmount.value);
  if (isNaN(amount) || amount <= 0) { alert("Digite um valor v√°lido."); return; }

  item.amount = amount;
  item.category = editCategory.value;
  item.note = (editNote.value || "").trim();

  closeEdit();
  const ok = await saveAll();
  if (!ok) return;
  renderAll();
}
window.saveEdit = saveEdit;

editBackdrop.addEventListener("click", (e) => { if (e.target === editBackdrop) closeEdit(); });

/* =========================
   Calend√°rio + detalhe
   ========================= */
function selectDay(iso){
  selectedDay = iso;
  const d = parseISO(iso);
  currentYear = d.getFullYear();
  currentMonth = d.getMonth();
  renderAll();
}
window.selectDay = selectDay;

function renderCalendar(){
  const cal = document.getElementById("calendar");
  const year = currentYear, month = currentMonth;

  const first = new Date(year, month, 1);
  const last = new Date(year, month+1, 0);
  const startDay = first.getDay();
  const daysInMonth = last.getDate();

  let html = "";
  const wd = ["Dom","Seg","Ter","Qua","Qui","Sex","S√°b"];
  for (const d of wd) html += `<div class="cal-day head">${d}</div>`;
  for (let i=0;i<startDay;i++) html += `<div class="cal-day head"></div>`;

  for (let day=1; day<=daysInMonth; day++){
    const iso = `${year}-${String(month+1).padStart(2,"0")}-${String(day).padStart(2,"0")}`;
    const hasData = expenses[iso] && expenses[iso].length > 0;
    const isToday = iso === todayISO;
    const isSel = iso === selectedDay;

    let cls = "cal-day";
    if (hasData) cls += " has-data";
    if (isToday) cls += " today";
    if (isSel) cls += " selected";

    html += `<div class="${cls}" onclick="selectDay('${iso}')">${day}</div>`;
  }
  cal.innerHTML = html;
}

function renderDayDetail(){
  const title = document.getElementById("selectedDayTitle");
  const sub = document.getElementById("selectedDaySubtitle");
  const listEl = document.getElementById("dayDetailList");

  title.textContent = `üßæ Detalhe do dia: ${formatBR(selectedDay)}`;
  const items = expenses[selectedDay] || [];
  const total = items.reduce((s,e)=> s + safeNumber(e.amount), 0);

  sub.textContent = items.length
    ? `Total do dia: ${formatCurrency(total)} ‚Ä¢ Itens: ${items.length}`
    : "Sem despesas neste dia.";

  if (!items.length){ listEl.innerHTML = ""; return; }

  const catMap = Object.fromEntries(CATEGORIES.map(c => [c.id, c.label]));
  listEl.innerHTML = items.map(it => `
    <div class="detail-item">
      <div style="min-width:0;">
        <div class="detail-main">${catMap[it.category] || it.category} ‚Ä¢ ${formatCurrency(safeNumber(it.amount))}</div>
        ${it.note ? `<div class="detail-note">${escapeHTML(it.note)}</div>` : `<div class="detail-note">‚Äî</div>`}
      </div>
      <div class="detail-actions">
        <button class="mini-btn btn-ghost" onclick="openEdit('${selectedDay}','${it.id}')">Editar</button>
        <button class="mini-btn btn-danger" onclick="deleteExpense('${selectedDay}','${it.id}')">Excluir</button>
      </div>
    </div>
  `).join("");
}

function renderBalance(){
  const total = dayTotal(todayISO);
  document.getElementById("balance").textContent = `Balan√ßo de hoje (${formatBR(todayISO)}): ${formatCurrency(total)}`;
}

function renderAll(){
  renderBalance();
  renderCalendar();
  renderDayDetail();
}

/* =========================
   Start
   ========================= */
(async function init(){
  await loadAll();
  renderAll();
})();
</script>
</body>
</html>
